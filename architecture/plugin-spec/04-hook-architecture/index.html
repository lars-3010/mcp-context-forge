<!DOCTYPE html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="MCP Gateway Documentation"><meta name=author content="Mihai Criveti"><link href=https://pages.github.com/ibm/mcp-context-forge/architecture/plugin-spec/04-hook-architecture/ rel=canonical><link href=../03-plugin-types/ rel=prev><link href=../05-hook-system/ rel=next><link rel=alternate type=application/rss+xml title="RSS feed" href=../../../feed_rss_created.xml><link rel=alternate type=application/rss+xml title="RSS feed of updated content" href=../../../feed_rss_updated.xml><link rel=icon href=../../../favicon.ico><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.19"><title>Hook Architecture - MCP Context Forge - Model Context Protocol Gateway</title><link rel=stylesheet href=../../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.06af60db.min.css><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link href=../../../assets/stylesheets/glightbox.min.css rel=stylesheet><script src=../../../assets/javascripts/glightbox.min.js></script><style id=glightbox-style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#5-hook-function-architecture class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="MCP Context Forge - Model Context Protocol Gateway" class="md-header__button md-logo" aria-label="MCP Context Forge - Model Context Protocol Gateway" data-md-component=logo> <img src=../../../logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MCP Context Forge - Model Context Protocol Gateway </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Hook Architecture </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/ibm/mcp-context-forge title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class=md-source__repository> ibm/mcp-context-forge </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> ğŸ  Home </a> </li> <li class=md-tabs__item> <a href=../../../overview/ class=md-tabs__link> ğŸ§­ Overview </a> </li> <li class=md-tabs__item> <a href=../../../using/ class=md-tabs__link> ğŸ§° Use </a> </li> <li class=md-tabs__item> <a href=../../../deployment/ class=md-tabs__link> ğŸš€ Deploy </a> </li> <li class=md-tabs__item> <a href=../../../manage/ class=md-tabs__link> ğŸ›¡ï¸ Manage </a> </li> <li class=md-tabs__item> <a href=../../../development/ class=md-tabs__link> ğŸ’» Develop </a> </li> <li class=md-tabs__item> <a href=../../../testing/ class=md-tabs__link> ğŸ§ª Test </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../ class=md-tabs__link> ğŸ“ Design &amp; Roadmap </a> </li> <li class=md-tabs__item> <a href=../../../media/ class=md-tabs__link> ğŸ“° Media </a> </li> <li class=md-tabs__item> <a href=../../../tutorials/ class=md-tabs__link> ğŸ“– Tutorials </a> </li> <li class=md-tabs__item> <a href=../../../best-practices/mcp-best-practices/ class=md-tabs__link> â­ Best Practices </a> </li> <li class=md-tabs__item> <a href=../../../faq/ class=md-tabs__link> â“ FAQ </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="MCP Context Forge - Model Context Protocol Gateway" class="md-nav__button md-logo" aria-label="MCP Context Forge - Model Context Protocol Gateway" data-md-component=logo> <img src=../../../logo.png alt=logo> </a> MCP Context Forge - Model Context Protocol Gateway </label> <div class=md-nav__source> <a href=https://github.com/ibm/mcp-context-forge title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg> </div> <div class=md-source__repository> ibm/mcp-context-forge </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> <span class=md-ellipsis> ğŸ  Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../../../overview/ class="md-nav__link "> <span class=md-ellipsis> ğŸ§­ Overview </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> ğŸ§­ Overview </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../overview/quick_start/ class=md-nav__link> <span class=md-ellipsis> ğŸš€ Quick Start </span> <span class="md-status md-status--draft"></span> </a> </li> <li class=md-nav__item> <a href=../../../overview/features/ class=md-nav__link> <span class=md-ellipsis> âœ¨ Features Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../overview/ui/ class=md-nav__link> <span class=md-ellipsis> Admin UI </span> </a> </li> <li class=md-nav__item> <a href=../../../overview/ui-concepts/ class=md-nav__link> <span class=md-ellipsis> Admin Console Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../../overview/passthrough/ class=md-nav__link> <span class=md-ellipsis> HTTP Header Passthrough </span> </a> </li> <li class=md-nav__item> <a href=../../../overview/tags/ class=md-nav__link> <span class=md-ellipsis> ğŸ·ï¸ Tags System </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <div class="md-nav__link md-nav__container"> <a href=../../../using/ class="md-nav__link "> <span class=md-ellipsis> ğŸ§° Use </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> ğŸ§° Use </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../using/mcpgateway-wrapper/ class=md-nav__link> <span class=md-ellipsis> ğŸ›  STDIO Wrapper (mcpgateway.wrapper) </span> </a> </li> <li class=md-nav__item> <a href=../../../using/mcpgateway-translate/ class=md-nav__link> <span class=md-ellipsis> MCP Gateway Transport Bridge (mcpgateway.translate) </span> </a> </li> <li class=md-nav__item> <a href=../../../using/reverse-proxy/ class=md-nav__link> <span class=md-ellipsis> MCP Reverse Proxy </span> </a> </li> <li class=md-nav__item> <a href=../../../using/multi-auth-headers/ class=md-nav__link> <span class=md-ellipsis> Multiple Authentication Headers </span> </a> </li> <li class=md-nav__item> <a href=../../../using/tool-annotations/ class=md-nav__link> <span class=md-ellipsis> Tool Annotations </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <div class="md-nav__link md-nav__container"> <a href=../../../using/clients/ class="md-nav__link "> <span class=md-ellipsis> Clients </span> </a> <label class="md-nav__link " for=__nav_3_7 id=__nav_3_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Clients </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../using/clients/mcp-inspector/ class=md-nav__link> <span class=md-ellipsis> MCP Inspector </span> </a> </li> <li class=md-nav__item> <a href=../../../using/clients/claude-desktop/ class=md-nav__link> <span class=md-ellipsis> Claude Desktop Ã— MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../using/clients/copilot/ class=md-nav__link> <span class=md-ellipsis> ğŸ§  GitHub Copilot + MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../using/clients/cline/ class=md-nav__link> <span class=md-ellipsis> Cline (VS Code Extension) </span> </a> </li> <li class=md-nav__item> <a href=../../../using/clients/continue/ class=md-nav__link> <span class=md-ellipsis> Continue (VS Code Extension) </span> </a> </li> <li class=md-nav__item> <a href=../../../using/clients/openwebui/ class=md-nav__link> <span class=md-ellipsis> OpenWebUI Integration with MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../using/clients/mcp-cli/ class=md-nav__link> <span class=md-ellipsis> ğŸ–¥ï¸ MCP CLI + MCP Context Forge Gateway </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8> <div class="md-nav__link md-nav__container"> <a href=../../../using/agents/ class="md-nav__link "> <span class=md-ellipsis> Agents </span> </a> <label class="md-nav__link " for=__nav_3_8 id=__nav_3_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Agents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../using/agents/langchain/ class=md-nav__link> <span class=md-ellipsis> LangChain Integration with MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../using/agents/langgraph/ class=md-nav__link> <span class=md-ellipsis> LangGraph Integration with MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../using/agents/crewai/ class=md-nav__link> <span class=md-ellipsis> CrewAI Integration with MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../using/agents/bee/ class=md-nav__link> <span class=md-ellipsis> Bee Agent Framework Integration with MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../using/agents/autogen/ class=md-nav__link> <span class=md-ellipsis> AutoGen Integration with MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../using/agents/semantic-kernel/ class=md-nav__link> <span class=md-ellipsis> Semantic Kernel Integration with MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../using/agents/openai-sdk/ class=md-nav__link> <span class=md-ellipsis> OpenAI Agents SDK + MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../using/agents/llamaindex/ class=md-nav__link> <span class=md-ellipsis> LlamaIndex Integration with MCP Gateway </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <div class="md-nav__link md-nav__container"> <a href=../../../using/servers/ class="md-nav__link "> <span class=md-ellipsis> MCP Servers </span> </a> <label class="md-nav__link " for=__nav_3_9 id=__nav_3_9_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> MCP Servers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9_2> <label class=md-nav__link for=__nav_3_9_2 id=__nav_3_9_2_label tabindex=0> <span class=md-ellipsis> Go Servers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_9_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9_2> <span class="md-nav__icon md-icon"></span> Go Servers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../using/servers/go/calculator-server/ class=md-nav__link> <span class=md-ellipsis> Go Calculator Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/go/fast-time-server/ class=md-nav__link> <span class=md-ellipsis> Go Fast Time Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/go/pandoc-server/ class=md-nav__link> <span class=md-ellipsis> Pandoc Server </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9_3> <label class=md-nav__link for=__nav_3_9_3 id=__nav_3_9_3_label tabindex=0> <span class=md-ellipsis> Python Servers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_9_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9_3> <span class="md-nav__icon md-icon"></span> Python Servers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../using/servers/python/chunker-server/ class=md-nav__link> <span class=md-ellipsis> Chunker Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/code-splitter-server/ class=md-nav__link> <span class=md-ellipsis> Code Splitter Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/csv-pandas-chat-server/ class=md-nav__link> <span class=md-ellipsis> CSV Pandas Chat Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/data-analysis-server/ class=md-nav__link> <span class=md-ellipsis> Python Data Analysis Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/docx-server/ class=md-nav__link> <span class=md-ellipsis> DOCX Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/eval-server/ class=md-nav__link> <span class=md-ellipsis> Python MCP Evaluation Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/graphviz-server/ class=md-nav__link> <span class=md-ellipsis> Graphviz Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/latex-server/ class=md-nav__link> <span class=md-ellipsis> LaTeX Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/libreoffice-server/ class=md-nav__link> <span class=md-ellipsis> LibreOffice Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/mermaid-server/ class=md-nav__link> <span class=md-ellipsis> Mermaid Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/plotly-server/ class=md-nav__link> <span class=md-ellipsis> Plotly Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/pptx-server/ class=md-nav__link> <span class=md-ellipsis> Python PowerPoint (PPTX) Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/python-sandbox-server/ class=md-nav__link> <span class=md-ellipsis> Python Sandbox Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/url-to-markdown-server/ class=md-nav__link> <span class=md-ellipsis> URL to Markdown Server </span> </a> </li> <li class=md-nav__item> <a href=../../../using/servers/python/xlsx-server/ class=md-nav__link> <span class=md-ellipsis> XLSX Server </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9_4> <label class=md-nav__link for=__nav_3_9_4 id=__nav_3_9_4_label tabindex=0> <span class=md-ellipsis> External Servers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_9_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9_4> <span class="md-nav__icon md-icon"></span> External Servers </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9_4_1> <label class=md-nav__link for=__nav_3_9_4_1 id=__nav_3_9_4_1_label tabindex=0> <span class=md-ellipsis> GitHub Copilot </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_9_4_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9_4_1> <span class="md-nav__icon md-icon"></span> GitHub Copilot </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../using/servers/external/microsoft/github/ class=md-nav__link> <span class=md-ellipsis> GitHub MCP Server </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9_4_2> <label class=md-nav__link for=__nav_3_9_4_2 id=__nav_3_9_4_2_label tabindex=0> <span class=md-ellipsis> Box </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_9_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9_4_2> <span class="md-nav__icon md-icon"></span> Box </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../using/servers/external/box/box/ class=md-nav__link> <span class=md-ellipsis> Box MCP Server </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9_4_3> <div class="md-nav__link md-nav__container"> <a href=../../../using/servers/external/open/ class="md-nav__link "> <span class=md-ellipsis> Open Servers </span> </a> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_9_4_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9_4_3> <span class="md-nav__icon md-icon"></span> Open Servers </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9_5> <label class=md-nav__link for=__nav_3_9_5 id=__nav_3_9_5_label tabindex=0> <span class=md-ellipsis> IBM Servers </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_9_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9_5> <span class="md-nav__icon md-icon"></span> IBM Servers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../using/servers/ibm/instana/ class=md-nav__link> <span class=md-ellipsis> IBM Instana MCP Server </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_10> <div class="md-nav__link md-nav__container"> <a href=../../../using/plugins/ class="md-nav__link "> <span class=md-ellipsis> Plugins </span> </a> <label class="md-nav__link " for=__nav_3_10 id=__nav_3_10_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_10_label aria-expanded=false> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> Plugins </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../using/plugins/lifecycle/ class=md-nav__link> <span class=md-ellipsis> Plugin Lifecycle </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <div class="md-nav__link md-nav__container"> <a href=../../../deployment/ class="md-nav__link "> <span class=md-ellipsis> ğŸš€ Deploy </span> </a> <label class="md-nav__link " for=__nav_4 id=__nav_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> ğŸš€ Deploy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../deployment/local/ class=md-nav__link> <span class=md-ellipsis> ğŸ Local Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/container/ class=md-nav__link> <span class=md-ellipsis> ğŸ“¦ Container Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/compose/ class=md-nav__link> <span class=md-ellipsis> ğŸ§© Docker Compose </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/kubernetes/ class=md-nav__link> <span class=md-ellipsis> â˜¸ï¸ Kubernetes / OpenShift Deployment </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/openshift/ class=md-nav__link> <span class=md-ellipsis> âœ¨ Red Hat OpenShift </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/minikube/ class=md-nav__link> <span class=md-ellipsis> âš¡ï¸ Minikube </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/helm/ class=md-nav__link> <span class=md-ellipsis> ğŸš€ Deploying the MCP Gateway Stack with Helm </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/argocd/ class=md-nav__link> <span class=md-ellipsis> ğŸš¢ Deploying the MCP Gateway Stack with Argo CD </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/google-cloud-run/ class=md-nav__link> <span class=md-ellipsis> â˜ï¸ Deploying MCP Gateway on Google Cloud Run </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/ibm-code-engine/ class=md-nav__link> <span class=md-ellipsis> âš™ï¸ IBM Code Engine </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/aws/ class=md-nav__link> <span class=md-ellipsis> ğŸŸ§ AWS </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/azure/ class=md-nav__link> <span class=md-ellipsis> ğŸ”· Azure </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/fly-io/ class=md-nav__link> <span class=md-ellipsis> âš™ï¸ Fly.io Deployment Guide for MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../deployment/proxy-auth/ class=md-nav__link> <span class=md-ellipsis> Proxy Authentication </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <div class="md-nav__link md-nav__container"> <a href=../../../manage/ class="md-nav__link "> <span class=md-ellipsis> ğŸ›¡ï¸ Manage </span> </a> <label class="md-nav__link " for=__nav_5 id=__nav_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> ğŸ›¡ï¸ Manage </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../manage/configuration/ class=md-nav__link> <span class=md-ellipsis> Configuration Reference </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/backup/ class=md-nav__link> <span class=md-ellipsis> Backups </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/bulk-import/ class=md-nav__link> <span class=md-ellipsis> Bulk Import Tools </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/metadata-tracking/ class=md-nav__link> <span class=md-ellipsis> ğŸ“Š Metadata Tracking &amp; Audit Trails </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/export-import/ class=md-nav__link> <span class=md-ellipsis> Configuration Export &amp; Import </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/export-import-tutorial/ class=md-nav__link> <span class=md-ellipsis> Export/Import Tutorial </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/export-import-reference/ class=md-nav__link> <span class=md-ellipsis> Export/Import Quick Reference </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/logging/ class=md-nav__link> <span class=md-ellipsis> Logging </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/logging-examples/ class=md-nav__link> <span class=md-ellipsis> Logging Examples for MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/observability/ class=md-nav__link> <span class=md-ellipsis> Observability </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5_12> <label class=md-nav__link for=__nav_5_12 id=__nav_5_12_label tabindex=0> <span class=md-ellipsis> Observability </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_5_12_label aria-expanded=false> <label class=md-nav__title for=__nav_5_12> <span class="md-nav__icon md-icon"></span> Observability </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../manage/observability/observability/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/observability/phoenix/ class=md-nav__link> <span class=md-ellipsis> Phoenix Integration </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../manage/proxy/ class=md-nav__link> <span class=md-ellipsis> Proxy Authentication </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/dcr/ class=md-nav__link> <span class=md-ellipsis> Dynamic Client Registration (DCR) </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/oauth/ class=md-nav__link> <span class=md-ellipsis> OAuth 2.0 Integration </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/securing/ class=md-nav__link> <span class=md-ellipsis> Securing MCP Gateway </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/sso/ class=md-nav__link> <span class=md-ellipsis> Single Sign-On (SSO) Authentication </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/sso-github-tutorial/ class=md-nav__link> <span class=md-ellipsis> GitHub SSO Setup Tutorial </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/sso-google-tutorial/ class=md-nav__link> <span class=md-ellipsis> Google OAuth/OIDC Setup Tutorial </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/sso-ibm-tutorial/ class=md-nav__link> <span class=md-ellipsis> IBM Security Verify Setup Tutorial </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/sso-okta-tutorial/ class=md-nav__link> <span class=md-ellipsis> Okta OIDC Setup Tutorial </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/tuning/ class=md-nav__link> <span class=md-ellipsis> Gateway Tuning Guide </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/ui-customization/ class=md-nav__link> <span class=md-ellipsis> Customizing the Admin UI </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/upgrade/ class=md-nav__link> <span class=md-ellipsis> Upgrading MCP Gateway and Managing Database Migrations </span> </a> </li> <li class=md-nav__item> <a href=../../../manage/well-known-uris/ class=md-nav__link> <span class=md-ellipsis> Well-Known URI Configuration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_6> <div class="md-nav__link md-nav__container"> <a href=../../../development/ class="md-nav__link "> <span class=md-ellipsis> ğŸ’» Develop </span> </a> <label class="md-nav__link " for=__nav_6 id=__nav_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> ğŸ’» Develop </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../development/developer-onboarding/ class=md-nav__link> <span class=md-ellipsis> âœ… Developer Onboarding Checklist </span> </a> </li> <li class=md-nav__item> <a href=../../../development/mcp-developer-guide-json-rpc/ class=md-nav__link> <span class=md-ellipsis> MCP JSON RPC Guide </span> </a> </li> <li class=md-nav__item> <a href=../../../development/github/ class=md-nav__link> <span class=md-ellipsis> GitHub Workflow Guide </span> </a> </li> <li class=md-nav__item> <a href=../../../development/building/ class=md-nav__link> <span class=md-ellipsis> Building Locally </span> </a> </li> <li class=md-nav__item> <a href=../../../development/documentation/ class=md-nav__link> <span class=md-ellipsis> Writing &amp; Publishing Documentation </span> </a> </li> <li class=md-nav__item> <a href=../../../development/review/ class=md-nav__link> <span class=md-ellipsis> Reviewing a Pull Request </span> </a> </li> <li class=md-nav__item> <a href=../../../development/packaging/ class=md-nav__link> <span class=md-ellipsis> Packaging &amp; Distribution </span> </a> </li> <li class=md-nav__item> <a href=../../../development/developer-workstation/ class=md-nav__link> <span class=md-ellipsis> Developer Workstation </span> </a> </li> <li class=md-nav__item> <a href=../../../development/doctest-coverage/ class=md-nav__link> <span class=md-ellipsis> Doctest Coverage </span> </a> </li> <li class=md-nav__item> <a href=../../../development/module-documentation/ class=md-nav__link> <span class=md-ellipsis> Module documentation </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_7> <div class="md-nav__link md-nav__container"> <a href=../../../testing/ class="md-nav__link "> <span class=md-ellipsis> ğŸ§ª Test </span> </a> <label class="md-nav__link " for=__nav_7 id=__nav_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> ğŸ§ª Test </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../testing/basic/ class=md-nav__link> <span class=md-ellipsis> MCP Gateway - Basic </span> </a> </li> <li class=md-nav__item> <a href=../../../testing/performance/ class=md-nav__link> <span class=md-ellipsis> Performance Testing </span> </a> </li> <li class=md-nav__item> <a href=../../../testing/acceptance/ class=md-nav__link> <span class=md-ellipsis> MCP Gateway Manual Acceptance Testing </span> </a> </li> <li class=md-nav__item> <a href=../../../testing/fuzzing/ class=md-nav__link> <span class=md-ellipsis> Fuzz Testing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> ğŸ“ Design &amp; Roadmap </span> </a> <label class="md-nav__link " for=__nav_8 id=__nav_8_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=true> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> ğŸ“ Design &amp; Roadmap </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../roadmap/ class=md-nav__link> <span class=md-ellipsis> Roadmap </span> </a> </li> <li class=md-nav__item> <a href=../../security-features/ class=md-nav__link> <span class=md-ellipsis> Security Features </span> </a> </li> <li class=md-nav__item> <a href=../../plugins/ class=md-nav__link> <span class=md-ellipsis> Plugin Framework </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_5 checked> <label class=md-nav__link for=__nav_8_5 id=__nav_8_5_label tabindex=0> <span class=md-ellipsis> Plugin Framework Specification </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_5_label aria-expanded=true> <label class=md-nav__title for=__nav_8_5> <span class="md-nav__icon md-icon"></span> Plugin Framework Specification </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../plugin-framework-specification/ class=md-nav__link> <span class=md-ellipsis> Overview </span> </a> </li> <li class=md-nav__item> <a href=../01-architecture/ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../02-core-components/ class=md-nav__link> <span class=md-ellipsis> Core Components </span> </a> </li> <li class=md-nav__item> <a href=../03-plugin-types/ class=md-nav__link> <span class=md-ellipsis> Plugin Types </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Hook Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Hook Architecture </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#5-hook-function-architecture class=md-nav__link> <span class=md-ellipsis> 5. Hook Function Architecture </span> </a> <nav class=md-nav aria-label="5. Hook Function Architecture"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-hook-function-overview class=md-nav__link> <span class=md-ellipsis> 5.1 Hook Function Overview </span> </a> </li> <li class=md-nav__item> <a href=#52-http-header-hook-integration-example class=md-nav__link> <span class=md-ellipsis> 5.2 HTTP Header Hook Integration Example </span> </a> </li> <li class=md-nav__item> <a href=#53-client-elicitation-support class=md-nav__link> <span class=md-ellipsis> 5.3 Client Elicitation Support </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../05-hook-system/ class=md-nav__link> <span class=md-ellipsis> Hook System </span> </a> </li> <li class=md-nav__item> <a href=../06-gateway-hooks/ class=md-nav__link> <span class=md-ellipsis> Gateway Hooks </span> </a> </li> <li class=md-nav__item> <a href=../07-security-hooks/ class=md-nav__link> <span class=md-ellipsis> Security Hooks </span> </a> </li> <li class=md-nav__item> <a href=../08-external-plugins/ class=md-nav__link> <span class=md-ellipsis> External Plugins </span> </a> </li> <li class=md-nav__item> <a href=../09-security/ class=md-nav__link> <span class=md-ellipsis> Security </span> </a> </li> <li class=md-nav__item> <a href=../10-error-handling/ class=md-nav__link> <span class=md-ellipsis> Error Handling </span> </a> </li> <li class=md-nav__item> <a href=../11-performance/ class=md-nav__link> <span class=md-ellipsis> Performance </span> </a> </li> <li class=md-nav__item> <a href=../12-development/ class=md-nav__link> <span class=md-ellipsis> Development </span> </a> </li> <li class=md-nav__item> <a href=../13-testing/ class=md-nav__link> <span class=md-ellipsis> Testing </span> </a> </li> <li class=md-nav__item> <a href=../14-conclusion/ class=md-nav__link> <span class=md-ellipsis> Conclusion </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../export-import-architecture/ class=md-nav__link> <span class=md-ellipsis> Export-Import Architecture </span> </a> </li> <li class=md-nav__item> <a href=../../multitenancy/ class=md-nav__link> <span class=md-ellipsis> Multitenancy </span> </a> </li> <li class=md-nav__item> <a href=../../oauth-design/ class=md-nav__link> <span class=md-ellipsis> OAuth </span> </a> </li> <li class=md-nav__item> <a href=../../oauth-authorization-code-ui-design/ class=md-nav__link> <span class=md-ellipsis> OAuth UI </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_8_10> <label class=md-nav__link for=__nav_8_10 id=__nav_8_10_label tabindex=0> <span class=md-ellipsis> Decision Records </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_8_10_label aria-expanded=false> <label class=md-nav__title for=__nav_8_10> <span class="md-nav__icon md-icon"></span> Decision Records </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../adr/001-adopt-fastapi-pydantic/ class=md-nav__link> <span class=md-ellipsis> 1 Adopt FastAPI + Pydantic </span> </a> </li> <li class=md-nav__item> <a href=../../adr/002-use-async-sqlalchemy-orm/ class=md-nav__link> <span class=md-ellipsis> 2 Use Async SQLAlchemy ORM </span> </a> </li> <li class=md-nav__item> <a href=../../adr/003-expose-multi-transport-endpoints/ class=md-nav__link> <span class=md-ellipsis> 3 Expose Multi-Transport Endpoints </span> </a> </li> <li class=md-nav__item> <a href=../../adr/004-combine-jwt-and-basic-auth/ class=md-nav__link> <span class=md-ellipsis> 4 Combine JWT &amp; Basic Auth </span> </a> </li> <li class=md-nav__item> <a href=../../adr/005-structured-json-logging/ class=md-nav__link> <span class=md-ellipsis> 5 Structured JSON Logging </span> </a> </li> <li class=md-nav__item> <a href=../../adr/006-gateway-tool-rate-limiting/ class=md-nav__link> <span class=md-ellipsis> 6 Gateway &amp; Tool-Level Rate Limiting </span> </a> </li> <li class=md-nav__item> <a href=../../adr/007-pluggable-cache-backend/ class=md-nav__link> <span class=md-ellipsis> 7 Pluggable Cache Backend </span> </a> </li> <li class=md-nav__item> <a href=../../adr/008-federation-discovery/ class=md-nav__link> <span class=md-ellipsis> 8 Federation &amp; Auto-Discovery via DNS-SD </span> </a> </li> <li class=md-nav__item> <a href=../../../000-built-in-health-checks.md class=md-nav__link> <span class=md-ellipsis> 9 Built-in Health Checks </span> </a> </li> <li class=md-nav__item> <a href=../../adr/010-observability-prometheus/ class=md-nav__link> <span class=md-ellipsis> 10 Observability via Prometheus </span> </a> </li> <li class=md-nav__item> <a href=../../adr/011-tool-federation/ class=md-nav__link> <span class=md-ellipsis> 11 Namespaced Tool Federation </span> </a> </li> <li class=md-nav__item> <a href=../../adr/012-dropdown-ui-tool-selection/ class=md-nav__link> <span class=md-ellipsis> 12 Drop-down tool selection </span> </a> </li> <li class=md-nav__item> <a href=../../adr/013-APIs-for-server-connection-strings/ class=md-nav__link> <span class=md-ellipsis> 13 APIs for server connection string </span> </a> </li> <li class=md-nav__item> <a href=../../adr/014-security-headers-cors-middleware/ class=md-nav__link> <span class=md-ellipsis> 14 Security Headers &amp; CORS Middleware </span> </a> </li> <li class=md-nav__item> <a href=../../adr/015-well-known-uri-handler/ class=md-nav__link> <span class=md-ellipsis> 15 Well-known URI Handler </span> </a> </li> <li class=md-nav__item> <a href=../../adr/016-plugin-framework-ai-middleware/ class=md-nav__link> <span class=md-ellipsis> 16 Plugin Framework &amp; AI Middleware </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9> <div class="md-nav__link md-nav__container"> <a href=../../../media/ class="md-nav__link "> <span class=md-ellipsis> ğŸ“° Media </span> </a> <label class="md-nav__link " for=__nav_9 id=__nav_9_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> ğŸ“° Media </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_2> <div class="md-nav__link md-nav__container"> <a href=../../../media/kit/ class="md-nav__link "> <span class=md-ellipsis> Media Kit </span> </a> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_2_label aria-expanded=false> <label class=md-nav__title for=__nav_9_2> <span class="md-nav__icon md-icon"></span> Media Kit </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_3> <div class="md-nav__link md-nav__container"> <a href=../../../media/press/ class="md-nav__link "> <span class=md-ellipsis> Press </span> </a> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_3_label aria-expanded=false> <label class=md-nav__title for=__nav_9_3> <span class="md-nav__icon md-icon"></span> Press </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_9_4> <div class="md-nav__link md-nav__container"> <a href=../../../media/social/ class="md-nav__link "> <span class=md-ellipsis> Social </span> </a> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_9_4_label aria-expanded=false> <label class=md-nav__title for=__nav_9_4> <span class="md-nav__icon md-icon"></span> Social </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_10> <div class="md-nav__link md-nav__container"> <a href=../../../tutorials/ class="md-nav__link "> <span class=md-ellipsis> ğŸ“– Tutorials </span> </a> <label class="md-nav__link " for=__nav_10 id=__nav_10_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> ğŸ“– Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/argocd-helm-deployment-ibm-cloud-iks/ class=md-nav__link> <span class=md-ellipsis> ğŸš€ Deploying the MCP Gateway Stack to IBM Cloud Kubernetes Service with Argo CD </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/openwebui-tutorial/ class=md-nav__link> <span class=md-ellipsis> OpenWebUI with Ollama, LiteLLM, MCPO, and MCP Gateway Deployment Guide </span> </a> </li> <li class=md-nav__item> <a href=../../../tutorials/dcr-hyprmcp/ class=md-nav__link> <span class=md-ellipsis> Dynamic Client Registration with HyprMCP </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> â­ Best Practices </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> â­ Best Practices </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../best-practices/mcp-best-practices/ class=md-nav__link> <span class=md-ellipsis> â­ Best Practices Guide </span> </a> </li> <li class=md-nav__item> <a href=../../../best-practices/developing-your-mcp-server-python/ class=md-nav__link> <span class=md-ellipsis> ğŸ› ï¸ Write an MCP Server in Python </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_12> <div class="md-nav__link md-nav__container"> <a href=../../../faq/ class="md-nav__link "> <span class=md-ellipsis> â“ FAQ </span> </a> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> â“ FAQ </label> <ul class=md-nav__list data-md-scrollfix> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/ibm/mcp-context-forge/edit/main/docs/docs/architecture/plugin-spec/04-hook-architecture.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m14.06 9 .94.94L5.92 19H5v-.92zm3.6-6c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29m-3.6 3.19L3 17.25V21h3.75L17.81 9.94z"></path></svg> </a> <h1>Hook Architecture</h1> <h2 id=5-hook-function-architecture>5. Hook Function Architecture<a class=headerlink href=#5-hook-function-architecture title="Permanent link">Â¶</a></h2> <h3 id=51-hook-function-overview>5.1 Hook Function Overview<a class=headerlink href=#51-hook-function-overview title="Permanent link">Â¶</a></h3> <p>Every hook function in the plugin framework follows a consistent architectural pattern designed for type safety, extensibility, and clear data flow. A hook function is a standardized interface that allows plugins to intercept and process MCP protocol operations at specific points in the request/response lifecycle.</p> <p><strong>Universal Hook Function Signature:</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>hook_function</span><span class=p>(</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>    <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>    <span class=n>payload</span><span class=p>:</span> <span class=n>PayloadType</span><span class=p>,</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=n>context</span><span class=p>:</span> <span class=n>PluginContext</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>PluginResult</span><span class=p>[</span><span class=n>PayloadType</span><span class=p>]</span>
</span></code></pre></div><p></p> <p>All hook functions share three fundamental components that provide a complete execution environment:</p> <ol> <li><strong>Payload</strong> - Contains the specific data being processed (request, response, or metadata)</li> <li><strong>Context</strong> - Provides request-scoped state and metadata shared across plugins</li> <li><strong>Plugin Result</strong> - Returns execution status, modifications, and control flow decisions</li> </ol> <p>This architecture enables plugins to:</p> <ul> <li><strong>Inspect</strong> incoming data through structured payloads</li> <li><strong>Transform</strong> data by returning modified payloads</li> <li><strong>Control Flow</strong> by blocking or allowing request continuation</li> <li><strong>Share State</strong> through context objects across plugin executions</li> <li><strong>Report Violations</strong> through structured violation objects</li> </ul> <h4 id=511-payload-component>5.1.1 Payload Component<a class=headerlink href=#511-payload-component title="Permanent link">Â¶</a></h4> <p>The <strong>Payload</strong> is a strongly-typed data container that carries the specific information being processed at each hook point. Payloads are immutable input objects that plugins can inspect and optionally modify.</p> <p><strong>Payload Characteristics:</strong></p> <ul> <li><strong>Type-Safe</strong>: All payloads extend Pydantic <code>BaseModel</code> for validation</li> <li><strong>Hook-Specific</strong>: Each hook type has its own payload structure</li> <li><strong>Immutable Input</strong>: Original payload is never modified directly</li> <li><strong>Modification Pattern</strong>: Plugins return new payload instances for modifications</li> </ul> <p><strong>Common Payload Structure:</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=k>class</span><span class=w> </span><span class=nc>BasePayload</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=w>    </span><span class=sd>"""Base payload structure for all hook types"""</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>    <span class=c1># Core identification (varies by hook type)</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>    <span class=n>name</span><span class=p>:</span> <span class=nb>str</span>                                  <span class=c1># Resource/tool/prompt identifier</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>    <span class=c1># Hook-specific data (varies by hook type)</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>    <span class=n>args</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>      <span class=c1># Parameters or arguments</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a>    <span class=n>result</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>               <span class=c1># Results or content (post-hooks)</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a>    <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>  <span class=c1># Additional metadata</span>
</span></code></pre></div><p></p> <p><strong>Payload Modification Pattern:</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># Plugin modifies payload by creating new instance</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=n>modified_payload</span> <span class=o>=</span> <span class=n>ToolPreInvokePayload</span><span class=p>(</span>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>    <span class=n>name</span><span class=o>=</span><span class=n>payload</span><span class=o>.</span><span class=n>name</span><span class=p>,</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a>    <span class=n>args</span><span class=o>=</span><span class=n>sanitized_args</span><span class=p>,</span>  <span class=c1># Modified arguments</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>    <span class=n>headers</span><span class=o>=</span><span class=n>payload</span><span class=o>.</span><span class=n>headers</span>
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a><span class=p>)</span>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a><span class=k>return</span> <span class=n>ToolPreInvokeResult</span><span class=p>(</span><span class=n>modified_payload</span><span class=o>=</span><span class=n>modified_payload</span><span class=p>)</span>
</span></code></pre></div><p></p> <h4 id=512-context-component>5.1.2 Context Component<a class=headerlink href=#512-context-component title="Permanent link">Â¶</a></h4> <p>The <strong>PluginContext</strong> provides request-scoped state management and metadata sharing between plugins during a single request lifecycle. The <strong>GlobalContext</strong> is an object that is shared across multiple plugins at particular pre/post hook pairs. It contains metadata about the hook point including information about tools, prompts and resources, and allows for state to be stored that can be passed to other plugins.</p> <p><strong>Context Architecture:</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=k>class</span><span class=w> </span><span class=nc>PluginContext</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=w>    </span><span class=sd>"""Per-plugin context with state management"""</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>    <span class=n>state</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>dict</span><span class=p>)</span>    <span class=c1># Plugin-local state</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a>    <span class=n>global_context</span><span class=p>:</span> <span class=n>GlobalContext</span>                           <span class=c1># Shared request context</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>    <span class=n>metadata</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>dict</span><span class=p>)</span> <span class=c1># Plugin execution metadata</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>    <span class=n>elicitation_responses</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>ElicitationResponse</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span> <span class=c1># Client elicitation responses</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a>    <span class=k>def</span><span class=w> </span><span class=nf>get_state</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>default</span><span class=p>:</span> <span class=n>Any</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Any</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-3-9><a id=__codelineno-3-9 name=__codelineno-3-9 href=#__codelineno-3-9></a>    <span class=k>def</span><span class=w> </span><span class=nf>set_state</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>value</span><span class=p>:</span> <span class=n>Any</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span> <span class=o>...</span>
</span><span id=__span-3-10><a id=__codelineno-3-10 name=__codelineno-3-10 href=#__codelineno-3-10></a>
</span><span id=__span-3-11><a id=__codelineno-3-11 name=__codelineno-3-11 href=#__codelineno-3-11></a><span class=k>class</span><span class=w> </span><span class=nc>GlobalContext</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-3-12><a id=__codelineno-3-12 name=__codelineno-3-12 href=#__codelineno-3-12></a><span class=w>    </span><span class=sd>"""Shared context across all plugins in a request"""</span>
</span><span id=__span-3-13><a id=__codelineno-3-13 name=__codelineno-3-13 href=#__codelineno-3-13></a>    <span class=n>request_id</span><span class=p>:</span> <span class=nb>str</span>                                         <span class=c1># Unique request identifier</span>
</span><span id=__span-3-14><a id=__codelineno-3-14 name=__codelineno-3-14 href=#__codelineno-3-14></a>    <span class=n>user</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>                              <span class=c1># User making request</span>
</span><span id=__span-3-15><a id=__codelineno-3-15 name=__codelineno-3-15 href=#__codelineno-3-15></a>    <span class=n>tenant_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>                         <span class=c1># Multi-tenant context</span>
</span><span id=__span-3-16><a id=__codelineno-3-16 name=__codelineno-3-16 href=#__codelineno-3-16></a>    <span class=n>server_id</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>                         <span class=c1># Virtual server context</span>
</span><span id=__span-3-17><a id=__codelineno-3-17 name=__codelineno-3-17 href=#__codelineno-3-17></a>    <span class=n>state</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>dict</span><span class=p>)</span>    <span class=c1># Cross-plugin shared state</span>
</span><span id=__span-3-18><a id=__codelineno-3-18 name=__codelineno-3-18 href=#__codelineno-3-18></a>    <span class=n>metadata</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>dict</span><span class=p>)</span> <span class=c1># Request metadata</span>
</span></code></pre></div><p></p> <p><strong>Context Usage Patterns:</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=c1># Access request information</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=n>user_id</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>global_context</span><span class=o>.</span><span class=n>user</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=n>request_id</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>global_context</span><span class=o>.</span><span class=n>request_id</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=c1># Store plugin-local state</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=n>context</span><span class=o>.</span><span class=n>set_state</span><span class=p>(</span><span class=s2>"processed_items"</span><span class=p>,</span> <span class=n>item_count</span><span class=p>)</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=n>previous_count</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>get_state</span><span class=p>(</span><span class=s2>"processed_items"</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=c1># Share data between plugins</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=n>context</span><span class=o>.</span><span class=n>global_context</span><span class=o>.</span><span class=n>state</span><span class=p>[</span><span class=s2>"security_scan_passed"</span><span class=p>]</span> <span class=o>=</span> <span class=kc>True</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=c1># Add execution metadata</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=p>[</span><span class=s2>"processing_time_ms"</span><span class=p>]</span> <span class=o>=</span> <span class=mi>45</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=n>context</span><span class=o>.</span><span class=n>metadata</span><span class=p>[</span><span class=s2>"items_filtered"</span><span class=p>]</span> <span class=o>=</span> <span class=mi>3</span>
</span></code></pre></div><p></p> <h4 id=513-plugin-result-component>5.1.3 Plugin Result Component<a class=headerlink href=#513-plugin-result-component title="Permanent link">Â¶</a></h4> <p>The <strong>PluginResult</strong> is the standardized return object that controls request flow and communicates plugin execution outcomes.</p> <p><strong>Plugin Result Architecture:</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>class</span><span class=w> </span><span class=nc>PluginResult</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>,</span> <span class=n>Generic</span><span class=p>[</span><span class=n>T</span><span class=p>]):</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>    </span><span class=sd>"""Generic plugin execution result"""</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=n>continue_processing</span><span class=p>:</span> <span class=nb>bool</span> <span class=o>=</span> <span class=kc>True</span>                        <span class=c1># Flow control</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>modified_payload</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>T</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>                    <span class=c1># Payload modifications</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=n>violation</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>PluginViolation</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>             <span class=c1># Policy violations</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>    <span class=n>elicitation_request</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=n>ElicitationRequest</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span> <span class=c1># Client elicitation request</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a>    <span class=n>metadata</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=n>Field</span><span class=p>(</span><span class=n>default_factory</span><span class=o>=</span><span class=nb>dict</span><span class=p>)</span> <span class=c1># Execution metadata</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=k>class</span><span class=w> </span><span class=nc>PluginViolation</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=w>    </span><span class=sd>"""Plugin policy violation details"""</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a>    <span class=n>reason</span><span class=p>:</span> <span class=nb>str</span>                                             <span class=c1># High-level violation reason</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>    <span class=n>description</span><span class=p>:</span> <span class=nb>str</span>                                        <span class=c1># Detailed human-readable description</span>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>    <span class=n>code</span><span class=p>:</span> <span class=nb>str</span>                                               <span class=c1># Machine-readable violation code</span>
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>    <span class=n>details</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>                                 <span class=c1># Additional structured context</span>
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>    <span class=n>_plugin_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>PrivateAttr</span><span class=p>(</span><span class=n>default</span><span class=o>=</span><span class=s2>""</span><span class=p>)</span>             <span class=c1># Plugin that detected violation</span>
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>
</span><span id=__span-5-17><a id=__codelineno-5-17 name=__codelineno-5-17 href=#__codelineno-5-17></a><span class=k>class</span><span class=w> </span><span class=nc>ElicitationRequest</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-5-18><a id=__codelineno-5-18 name=__codelineno-5-18 href=#__codelineno-5-18></a><span class=w>    </span><span class=sd>"""Request for client elicitation during plugin execution"""</span>
</span><span id=__span-5-19><a id=__codelineno-5-19 name=__codelineno-5-19 href=#__codelineno-5-19></a>    <span class=n>message</span><span class=p>:</span> <span class=nb>str</span>                                            <span class=c1># Message to display to user</span>
</span><span id=__span-5-20><a id=__codelineno-5-20 name=__codelineno-5-20 href=#__codelineno-5-20></a>    <span class=n>schema</span><span class=p>:</span> <span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]</span>                                  <span class=c1># JSON schema for response validation</span>
</span><span id=__span-5-21><a id=__codelineno-5-21 name=__codelineno-5-21 href=#__codelineno-5-21></a>    <span class=n>timeout_seconds</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=mi>30</span>                     <span class=c1># Elicitation timeout</span>
</span><span id=__span-5-22><a id=__codelineno-5-22 name=__codelineno-5-22 href=#__codelineno-5-22></a>
</span><span id=__span-5-23><a id=__codelineno-5-23 name=__codelineno-5-23 href=#__codelineno-5-23></a><span class=k>class</span><span class=w> </span><span class=nc>ElicitationResponse</span><span class=p>(</span><span class=n>BaseModel</span><span class=p>):</span>
</span><span id=__span-5-24><a id=__codelineno-5-24 name=__codelineno-5-24 href=#__codelineno-5-24></a><span class=w>    </span><span class=sd>"""Response from client elicitation"""</span>
</span><span id=__span-5-25><a id=__codelineno-5-25 name=__codelineno-5-25 href=#__codelineno-5-25></a>    <span class=n>action</span><span class=p>:</span> <span class=n>Literal</span><span class=p>[</span><span class=s2>"accept"</span><span class=p>,</span> <span class=s2>"decline"</span><span class=p>,</span> <span class=s2>"cancel"</span><span class=p>]</span>          <span class=c1># User action taken</span>
</span><span id=__span-5-26><a id=__codelineno-5-26 name=__codelineno-5-26 href=#__codelineno-5-26></a>    <span class=n>data</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span> <span class=n>Any</span><span class=p>]]</span> <span class=o>=</span> <span class=kc>None</span>                   <span class=c1># User-provided data (if accepted)</span>
</span><span id=__span-5-27><a id=__codelineno-5-27 name=__codelineno-5-27 href=#__codelineno-5-27></a>    <span class=n>message</span><span class=p>:</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=kc>None</span>                           <span class=c1># Optional user message</span>
</span></code></pre></div><p></p> <p><strong>Plugin Result Usage Patterns:</strong> </p><div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Allow request to continue (default behavior)</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=k>return</span> <span class=n>PluginResult</span><span class=p>()</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=c1># Allow with payload modification</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a><span class=k>return</span> <span class=n>PluginResult</span><span class=p>(</span>
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>    <span class=n>modified_payload</span><span class=o>=</span><span class=n>modified_payload</span><span class=p>,</span>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a>    <span class=n>metadata</span><span class=o>=</span><span class=p>{</span><span class=s2>"items_sanitized"</span><span class=p>:</span> <span class=mi>5</span><span class=p>}</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a><span class=p>)</span>
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=c1># Block request with violation</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a><span class=n>violation</span> <span class=o>=</span> <span class=n>PluginViolation</span><span class=p>(</span>
</span><span id=__span-6-12><a id=__codelineno-6-12 name=__codelineno-6-12 href=#__codelineno-6-12></a>    <span class=n>reason</span><span class=o>=</span><span class=s2>"Unauthorized access"</span><span class=p>,</span>
</span><span id=__span-6-13><a id=__codelineno-6-13 name=__codelineno-6-13 href=#__codelineno-6-13></a>    <span class=n>description</span><span class=o>=</span><span class=s2>"User lacks permission for this resource"</span><span class=p>,</span>
</span><span id=__span-6-14><a id=__codelineno-6-14 name=__codelineno-6-14 href=#__codelineno-6-14></a>    <span class=n>code</span><span class=o>=</span><span class=s2>"ACCESS_DENIED"</span><span class=p>,</span>
</span><span id=__span-6-15><a id=__codelineno-6-15 name=__codelineno-6-15 href=#__codelineno-6-15></a>    <span class=n>details</span><span class=o>=</span><span class=p>{</span><span class=s2>"user_id"</span><span class=p>:</span> <span class=n>user_id</span><span class=p>,</span> <span class=s2>"resource"</span><span class=p>:</span> <span class=n>resource_name</span><span class=p>}</span>
</span><span id=__span-6-16><a id=__codelineno-6-16 name=__codelineno-6-16 href=#__codelineno-6-16></a><span class=p>)</span>
</span><span id=__span-6-17><a id=__codelineno-6-17 name=__codelineno-6-17 href=#__codelineno-6-17></a><span class=k>return</span> <span class=n>PluginResult</span><span class=p>(</span>
</span><span id=__span-6-18><a id=__codelineno-6-18 name=__codelineno-6-18 href=#__codelineno-6-18></a>    <span class=n>continue_processing</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-6-19><a id=__codelineno-6-19 name=__codelineno-6-19 href=#__codelineno-6-19></a>    <span class=n>violation</span><span class=o>=</span><span class=n>violation</span>
</span><span id=__span-6-20><a id=__codelineno-6-20 name=__codelineno-6-20 href=#__codelineno-6-20></a><span class=p>)</span>
</span><span id=__span-6-21><a id=__codelineno-6-21 name=__codelineno-6-21 href=#__codelineno-6-21></a>
</span><span id=__span-6-22><a id=__codelineno-6-22 name=__codelineno-6-22 href=#__codelineno-6-22></a><span class=c1># Allow but report metadata (monitoring/logging)</span>
</span><span id=__span-6-23><a id=__codelineno-6-23 name=__codelineno-6-23 href=#__codelineno-6-23></a><span class=k>return</span> <span class=n>PluginResult</span><span class=p>(</span>
</span><span id=__span-6-24><a id=__codelineno-6-24 name=__codelineno-6-24 href=#__codelineno-6-24></a>    <span class=n>metadata</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-6-25><a id=__codelineno-6-25 name=__codelineno-6-25 href=#__codelineno-6-25></a>        <span class=s2>"scan_duration_ms"</span><span class=p>:</span> <span class=mi>150</span><span class=p>,</span>
</span><span id=__span-6-26><a id=__codelineno-6-26 name=__codelineno-6-26 href=#__codelineno-6-26></a>        <span class=s2>"threats_detected"</span><span class=p>:</span> <span class=mi>0</span><span class=p>,</span>
</span><span id=__span-6-27><a id=__codelineno-6-27 name=__codelineno-6-27 href=#__codelineno-6-27></a>        <span class=s2>"confidence_score"</span><span class=p>:</span> <span class=mf>0.95</span>
</span><span id=__span-6-28><a id=__codelineno-6-28 name=__codelineno-6-28 href=#__codelineno-6-28></a>    <span class=p>}</span>
</span><span id=__span-6-29><a id=__codelineno-6-29 name=__codelineno-6-29 href=#__codelineno-6-29></a><span class=p>)</span>
</span></code></pre></div><p></p> <p><strong>Flow Control Logic:</strong></p> <ul> <li><code>continue_processing=True</code>: Request continues to next plugin/core logic</li> <li><code>continue_processing=False</code>: Request is blocked, violation returned to client</li> <li><code>modified_payload</code>: Used for next plugin execution if provided</li> <li><code>violation</code>: Structured error information for blocked requests</li> <li><code>metadata</code>: Observability and debugging information</li> </ul> <p><strong>Processing Model</strong>:</p> <p>Plugin processing uses short circuiting to abort evaluation in the case of a violation and <code>continue_processing=False</code>. If the plugin needs to record side effects, such as the bookkeeping, these plugins should be executed first with the highest priority. </p> <h3 id=52-http-header-hook-integration-example>5.2 HTTP Header Hook Integration Example<a class=headerlink href=#52-http-header-hook-integration-example title="Permanent link">Â¶</a></h3> <p>The HTTP header hooks provide powerful capabilities for authentication, security, and compliance. Here's a comprehensive example showing how to implement both pre and post HTTP forwarding hooks for enterprise security:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kn>from</span><span class=w> </span><span class=nn>mcpgateway.plugins.framework</span><span class=w> </span><span class=kn>import</span> <span class=n>Plugin</span><span class=p>,</span> <span class=n>PluginConfig</span><span class=p>,</span> <span class=n>HookType</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=kn>from</span><span class=w> </span><span class=nn>mcpgateway.plugins.framework.models</span><span class=w> </span><span class=kn>import</span> <span class=p>(</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>    <span class=n>HttpHeaderPayload</span><span class=p>,</span> <span class=n>HttpHeaderPayloadResult</span><span class=p>,</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>    <span class=n>PluginContext</span><span class=p>,</span> <span class=n>PluginViolation</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=p>)</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a><span class=kn>import</span><span class=w> </span><span class=nn>datetime</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=k>class</span><span class=w> </span><span class=nc>SecurityHeaderPlugin</span><span class=p>(</span><span class=n>Plugin</span><span class=p>):</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a><span class=w>    </span><span class=sd>"""Enterprise security plugin for HTTP header management."""</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>config</span><span class=p>:</span> <span class=n>PluginConfig</span><span class=p>):</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>config</span><span class=p>)</span>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a>        <span class=bp>self</span><span class=o>.</span><span class=n>required_security_headers</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a>            <span class=s2>"Content-Security-Policy"</span><span class=p>,</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a>            <span class=s2>"X-Frame-Options"</span><span class=p>,</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a>            <span class=s2>"X-Content-Type-Options"</span>
</span><span id=__span-7-17><a id=__codelineno-7-17 name=__codelineno-7-17 href=#__codelineno-7-17></a>        <span class=p>]</span>
</span><span id=__span-7-18><a id=__codelineno-7-18 name=__codelineno-7-18 href=#__codelineno-7-18></a>
</span><span id=__span-7-19><a id=__codelineno-7-19 name=__codelineno-7-19 href=#__codelineno-7-19></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>http_pre_forwarding_call</span><span class=p>(</span>
</span><span id=__span-7-20><a id=__codelineno-7-20 name=__codelineno-7-20 href=#__codelineno-7-20></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-7-21><a id=__codelineno-7-21 name=__codelineno-7-21 href=#__codelineno-7-21></a>        <span class=n>payload</span><span class=p>:</span> <span class=n>HttpHeaderPayload</span><span class=p>,</span>
</span><span id=__span-7-22><a id=__codelineno-7-22 name=__codelineno-7-22 href=#__codelineno-7-22></a>        <span class=n>context</span><span class=p>:</span> <span class=n>PluginContext</span>
</span><span id=__span-7-23><a id=__codelineno-7-23 name=__codelineno-7-23 href=#__codelineno-7-23></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>HttpHeaderPayloadResult</span><span class=p>:</span>
</span><span id=__span-7-24><a id=__codelineno-7-24 name=__codelineno-7-24 href=#__codelineno-7-24></a><span class=w>        </span><span class=sd>"""Inject authentication and security headers before forwarding."""</span>
</span><span id=__span-7-25><a id=__codelineno-7-25 name=__codelineno-7-25 href=#__codelineno-7-25></a>
</span><span id=__span-7-26><a id=__codelineno-7-26 name=__codelineno-7-26 href=#__codelineno-7-26></a>        <span class=n>modified_headers</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>payload</span><span class=o>.</span><span class=n>root</span><span class=p>)</span>
</span><span id=__span-7-27><a id=__codelineno-7-27 name=__codelineno-7-27 href=#__codelineno-7-27></a>
</span><span id=__span-7-28><a id=__codelineno-7-28 name=__codelineno-7-28 href=#__codelineno-7-28></a>        <span class=c1># 1. Authentication token injection based on user context</span>
</span><span id=__span-7-29><a id=__codelineno-7-29 name=__codelineno-7-29 href=#__codelineno-7-29></a>        <span class=k>if</span> <span class=n>context</span><span class=o>.</span><span class=n>global_context</span><span class=o>.</span><span class=n>user</span><span class=p>:</span>
</span><span id=__span-7-30><a id=__codelineno-7-30 name=__codelineno-7-30 href=#__codelineno-7-30></a>            <span class=c1># Get user-specific token from secure storage</span>
</span><span id=__span-7-31><a id=__codelineno-7-31 name=__codelineno-7-31 href=#__codelineno-7-31></a>            <span class=n>token</span> <span class=o>=</span> <span class=k>await</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_user_token</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>global_context</span><span class=o>.</span><span class=n>user</span><span class=p>)</span>
</span><span id=__span-7-32><a id=__codelineno-7-32 name=__codelineno-7-32 href=#__codelineno-7-32></a>            <span class=n>modified_headers</span><span class=p>[</span><span class=s2>"Authorization"</span><span class=p>]</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>"Bearer </span><span class=si>{</span><span class=n>token</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-7-33><a id=__codelineno-7-33 name=__codelineno-7-33 href=#__codelineno-7-33></a>
</span><span id=__span-7-34><a id=__codelineno-7-34 name=__codelineno-7-34 href=#__codelineno-7-34></a>        <span class=c1># 2. Add data classification headers for compliance</span>
</span><span id=__span-7-35><a id=__codelineno-7-35 name=__codelineno-7-35 href=#__codelineno-7-35></a>        <span class=n>data_class</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_classify_request_data</span><span class=p>(</span><span class=n>context</span><span class=o>.</span><span class=n>global_context</span><span class=p>)</span>
</span><span id=__span-7-36><a id=__codelineno-7-36 name=__codelineno-7-36 href=#__codelineno-7-36></a>        <span class=n>modified_headers</span><span class=p>[</span><span class=s2>"X-Data-Classification"</span><span class=p>]</span> <span class=o>=</span> <span class=n>data_class</span>
</span><span id=__span-7-37><a id=__codelineno-7-37 name=__codelineno-7-37 href=#__codelineno-7-37></a>
</span><span id=__span-7-38><a id=__codelineno-7-38 name=__codelineno-7-38 href=#__codelineno-7-38></a>        <span class=c1># 3. Add session tracking for audit purposes</span>
</span><span id=__span-7-39><a id=__codelineno-7-39 name=__codelineno-7-39 href=#__codelineno-7-39></a>        <span class=n>modified_headers</span><span class=p>[</span><span class=s2>"X-Session-ID"</span><span class=p>]</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>global_context</span><span class=o>.</span><span class=n>request_id</span>
</span><span id=__span-7-40><a id=__codelineno-7-40 name=__codelineno-7-40 href=#__codelineno-7-40></a>        <span class=n>modified_headers</span><span class=p>[</span><span class=s2>"X-Tenant-ID"</span><span class=p>]</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>global_context</span><span class=o>.</span><span class=n>tenant_id</span> <span class=ow>or</span> <span class=s2>"default"</span>
</span><span id=__span-7-41><a id=__codelineno-7-41 name=__codelineno-7-41 href=#__codelineno-7-41></a>
</span><span id=__span-7-42><a id=__codelineno-7-42 name=__codelineno-7-42 href=#__codelineno-7-42></a>        <span class=c1># 4. Add security headers for OWASP compliance</span>
</span><span id=__span-7-43><a id=__codelineno-7-43 name=__codelineno-7-43 href=#__codelineno-7-43></a>        <span class=n>modified_headers</span><span class=o>.</span><span class=n>update</span><span class=p>({</span>
</span><span id=__span-7-44><a id=__codelineno-7-44 name=__codelineno-7-44 href=#__codelineno-7-44></a>            <span class=s2>"X-Content-Type-Options"</span><span class=p>:</span> <span class=s2>"nosniff"</span><span class=p>,</span>
</span><span id=__span-7-45><a id=__codelineno-7-45 name=__codelineno-7-45 href=#__codelineno-7-45></a>            <span class=s2>"X-Frame-Options"</span><span class=p>:</span> <span class=s2>"DENY"</span><span class=p>,</span>
</span><span id=__span-7-46><a id=__codelineno-7-46 name=__codelineno-7-46 href=#__codelineno-7-46></a>            <span class=s2>"Referrer-Policy"</span><span class=p>:</span> <span class=s2>"strict-origin-when-cross-origin"</span>
</span><span id=__span-7-47><a id=__codelineno-7-47 name=__codelineno-7-47 href=#__codelineno-7-47></a>        <span class=p>})</span>
</span><span id=__span-7-48><a id=__codelineno-7-48 name=__codelineno-7-48 href=#__codelineno-7-48></a>
</span><span id=__span-7-49><a id=__codelineno-7-49 name=__codelineno-7-49 href=#__codelineno-7-49></a>        <span class=k>return</span> <span class=n>HttpHeaderPayloadResult</span><span class=p>(</span>
</span><span id=__span-7-50><a id=__codelineno-7-50 name=__codelineno-7-50 href=#__codelineno-7-50></a>            <span class=n>continue_processing</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-7-51><a id=__codelineno-7-51 name=__codelineno-7-51 href=#__codelineno-7-51></a>            <span class=n>modified_payload</span><span class=o>=</span><span class=n>HttpHeaderPayload</span><span class=p>(</span><span class=n>modified_headers</span><span class=p>),</span>
</span><span id=__span-7-52><a id=__codelineno-7-52 name=__codelineno-7-52 href=#__codelineno-7-52></a>            <span class=n>metadata</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-7-53><a id=__codelineno-7-53 name=__codelineno-7-53 href=#__codelineno-7-53></a>                <span class=s2>"plugin"</span><span class=p>:</span> <span class=s2>"security_header"</span><span class=p>,</span>
</span><span id=__span-7-54><a id=__codelineno-7-54 name=__codelineno-7-54 href=#__codelineno-7-54></a>                <span class=s2>"action"</span><span class=p>:</span> <span class=s2>"auth_injected"</span><span class=p>,</span>
</span><span id=__span-7-55><a id=__codelineno-7-55 name=__codelineno-7-55 href=#__codelineno-7-55></a>                <span class=s2>"data_classification"</span><span class=p>:</span> <span class=n>data_class</span><span class=p>,</span>
</span><span id=__span-7-56><a id=__codelineno-7-56 name=__codelineno-7-56 href=#__codelineno-7-56></a>                <span class=s2>"headers_added"</span><span class=p>:</span> <span class=mi>6</span>
</span><span id=__span-7-57><a id=__codelineno-7-57 name=__codelineno-7-57 href=#__codelineno-7-57></a>            <span class=p>}</span>
</span><span id=__span-7-58><a id=__codelineno-7-58 name=__codelineno-7-58 href=#__codelineno-7-58></a>        <span class=p>)</span>
</span><span id=__span-7-59><a id=__codelineno-7-59 name=__codelineno-7-59 href=#__codelineno-7-59></a>
</span><span id=__span-7-60><a id=__codelineno-7-60 name=__codelineno-7-60 href=#__codelineno-7-60></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>http_post_forwarding_call</span><span class=p>(</span>
</span><span id=__span-7-61><a id=__codelineno-7-61 name=__codelineno-7-61 href=#__codelineno-7-61></a>        <span class=bp>self</span><span class=p>,</span>
</span><span id=__span-7-62><a id=__codelineno-7-62 name=__codelineno-7-62 href=#__codelineno-7-62></a>        <span class=n>payload</span><span class=p>:</span> <span class=n>HttpHeaderPayload</span><span class=p>,</span>
</span><span id=__span-7-63><a id=__codelineno-7-63 name=__codelineno-7-63 href=#__codelineno-7-63></a>        <span class=n>context</span><span class=p>:</span> <span class=n>PluginContext</span>
</span><span id=__span-7-64><a id=__codelineno-7-64 name=__codelineno-7-64 href=#__codelineno-7-64></a>    <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>HttpHeaderPayloadResult</span><span class=p>:</span>
</span><span id=__span-7-65><a id=__codelineno-7-65 name=__codelineno-7-65 href=#__codelineno-7-65></a><span class=w>        </span><span class=sd>"""Validate response headers and add compliance metadata."""</span>
</span><span id=__span-7-66><a id=__codelineno-7-66 name=__codelineno-7-66 href=#__codelineno-7-66></a>
</span><span id=__span-7-67><a id=__codelineno-7-67 name=__codelineno-7-67 href=#__codelineno-7-67></a>        <span class=n>modified_headers</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>payload</span><span class=o>.</span><span class=n>root</span><span class=p>)</span>
</span><span id=__span-7-68><a id=__codelineno-7-68 name=__codelineno-7-68 href=#__codelineno-7-68></a>
</span><span id=__span-7-69><a id=__codelineno-7-69 name=__codelineno-7-69 href=#__codelineno-7-69></a>        <span class=c1># 1. Validate required security headers are present</span>
</span><span id=__span-7-70><a id=__codelineno-7-70 name=__codelineno-7-70 href=#__codelineno-7-70></a>        <span class=n>missing_headers</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-7-71><a id=__codelineno-7-71 name=__codelineno-7-71 href=#__codelineno-7-71></a>            <span class=n>h</span> <span class=k>for</span> <span class=n>h</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>required_security_headers</span>
</span><span id=__span-7-72><a id=__codelineno-7-72 name=__codelineno-7-72 href=#__codelineno-7-72></a>            <span class=k>if</span> <span class=n>h</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>payload</span><span class=o>.</span><span class=n>root</span>
</span><span id=__span-7-73><a id=__codelineno-7-73 name=__codelineno-7-73 href=#__codelineno-7-73></a>        <span class=p>]</span>
</span><span id=__span-7-74><a id=__codelineno-7-74 name=__codelineno-7-74 href=#__codelineno-7-74></a>
</span><span id=__span-7-75><a id=__codelineno-7-75 name=__codelineno-7-75 href=#__codelineno-7-75></a>        <span class=k>if</span> <span class=n>missing_headers</span><span class=p>:</span>
</span><span id=__span-7-76><a id=__codelineno-7-76 name=__codelineno-7-76 href=#__codelineno-7-76></a>            <span class=k>return</span> <span class=n>HttpHeaderPayloadResult</span><span class=p>(</span>
</span><span id=__span-7-77><a id=__codelineno-7-77 name=__codelineno-7-77 href=#__codelineno-7-77></a>                <span class=n>continue_processing</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-7-78><a id=__codelineno-7-78 name=__codelineno-7-78 href=#__codelineno-7-78></a>                <span class=n>violation</span><span class=o>=</span><span class=n>PluginViolation</span><span class=p>(</span>
</span><span id=__span-7-79><a id=__codelineno-7-79 name=__codelineno-7-79 href=#__codelineno-7-79></a>                    <span class=n>code</span><span class=o>=</span><span class=s2>"SECURITY_HEADERS_MISSING"</span><span class=p>,</span>
</span><span id=__span-7-80><a id=__codelineno-7-80 name=__codelineno-7-80 href=#__codelineno-7-80></a>                    <span class=n>reason</span><span class=o>=</span><span class=s2>"Required security headers not found in response"</span><span class=p>,</span>
</span><span id=__span-7-81><a id=__codelineno-7-81 name=__codelineno-7-81 href=#__codelineno-7-81></a>                    <span class=n>description</span><span class=o>=</span><span class=sa>f</span><span class=s2>"Missing headers: </span><span class=si>{</span><span class=s1>', '</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>missing_headers</span><span class=p>)</span><span class=si>}</span><span class=s2>"</span><span class=p>,</span>
</span><span id=__span-7-82><a id=__codelineno-7-82 name=__codelineno-7-82 href=#__codelineno-7-82></a>                    <span class=n>plugin_name</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span>
</span><span id=__span-7-83><a id=__codelineno-7-83 name=__codelineno-7-83 href=#__codelineno-7-83></a>                <span class=p>),</span>
</span><span id=__span-7-84><a id=__codelineno-7-84 name=__codelineno-7-84 href=#__codelineno-7-84></a>                <span class=n>metadata</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-7-85><a id=__codelineno-7-85 name=__codelineno-7-85 href=#__codelineno-7-85></a>                    <span class=s2>"plugin"</span><span class=p>:</span> <span class=s2>"security_header"</span><span class=p>,</span>
</span><span id=__span-7-86><a id=__codelineno-7-86 name=__codelineno-7-86 href=#__codelineno-7-86></a>                    <span class=s2>"action"</span><span class=p>:</span> <span class=s2>"validation_failed"</span><span class=p>,</span>
</span><span id=__span-7-87><a id=__codelineno-7-87 name=__codelineno-7-87 href=#__codelineno-7-87></a>                    <span class=s2>"missing_headers"</span><span class=p>:</span> <span class=n>missing_headers</span>
</span><span id=__span-7-88><a id=__codelineno-7-88 name=__codelineno-7-88 href=#__codelineno-7-88></a>                <span class=p>}</span>
</span><span id=__span-7-89><a id=__codelineno-7-89 name=__codelineno-7-89 href=#__codelineno-7-89></a>            <span class=p>)</span>
</span><span id=__span-7-90><a id=__codelineno-7-90 name=__codelineno-7-90 href=#__codelineno-7-90></a>
</span><span id=__span-7-91><a id=__codelineno-7-91 name=__codelineno-7-91 href=#__codelineno-7-91></a>        <span class=c1># 2. Add audit trail for compliance</span>
</span><span id=__span-7-92><a id=__codelineno-7-92 name=__codelineno-7-92 href=#__codelineno-7-92></a>        <span class=n>modified_headers</span><span class=p>[</span><span class=s2>"X-Audit-Trail"</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span>
</span><span id=__span-7-93><a id=__codelineno-7-93 name=__codelineno-7-93 href=#__codelineno-7-93></a>            <span class=sa>f</span><span class=s2>"processed-</span><span class=si>{</span><span class=n>context</span><span class=o>.</span><span class=n>global_context</span><span class=o>.</span><span class=n>request_id</span><span class=si>}</span><span class=s2>-"</span>
</span><span id=__span-7-94><a id=__codelineno-7-94 name=__codelineno-7-94 href=#__codelineno-7-94></a>            <span class=sa>f</span><span class=s2>"</span><span class=si>{</span><span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>utcnow</span><span class=p>()</span><span class=o>.</span><span class=n>isoformat</span><span class=p>()</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-7-95><a id=__codelineno-7-95 name=__codelineno-7-95 href=#__codelineno-7-95></a>        <span class=p>)</span>
</span><span id=__span-7-96><a id=__codelineno-7-96 name=__codelineno-7-96 href=#__codelineno-7-96></a>
</span><span id=__span-7-97><a id=__codelineno-7-97 name=__codelineno-7-97 href=#__codelineno-7-97></a>        <span class=c1># 3. Extract and log performance metrics</span>
</span><span id=__span-7-98><a id=__codelineno-7-98 name=__codelineno-7-98 href=#__codelineno-7-98></a>        <span class=n>response_time</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>root</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>"X-Response-Time"</span><span class=p>)</span>
</span><span id=__span-7-99><a id=__codelineno-7-99 name=__codelineno-7-99 href=#__codelineno-7-99></a>        <span class=k>if</span> <span class=n>response_time</span><span class=p>:</span>
</span><span id=__span-7-100><a id=__codelineno-7-100 name=__codelineno-7-100 href=#__codelineno-7-100></a>            <span class=n>context</span><span class=o>.</span><span class=n>global_context</span><span class=o>.</span><span class=n>metadata</span><span class=p>[</span><span class=s2>"response_time"</span><span class=p>]</span> <span class=o>=</span> <span class=n>response_time</span>
</span><span id=__span-7-101><a id=__codelineno-7-101 name=__codelineno-7-101 href=#__codelineno-7-101></a>
</span><span id=__span-7-102><a id=__codelineno-7-102 name=__codelineno-7-102 href=#__codelineno-7-102></a>        <span class=c1># 4. Add data governance labels</span>
</span><span id=__span-7-103><a id=__codelineno-7-103 name=__codelineno-7-103 href=#__codelineno-7-103></a>        <span class=n>modified_headers</span><span class=p>[</span><span class=s2>"X-Data-Retention"</span><span class=p>]</span> <span class=o>=</span> <span class=s2>"30d"</span>
</span><span id=__span-7-104><a id=__codelineno-7-104 name=__codelineno-7-104 href=#__codelineno-7-104></a>        <span class=n>modified_headers</span><span class=p>[</span><span class=s2>"X-Processing-Complete"</span><span class=p>]</span> <span class=o>=</span> <span class=s2>"true"</span>
</span><span id=__span-7-105><a id=__codelineno-7-105 name=__codelineno-7-105 href=#__codelineno-7-105></a>
</span><span id=__span-7-106><a id=__codelineno-7-106 name=__codelineno-7-106 href=#__codelineno-7-106></a>        <span class=k>return</span> <span class=n>HttpHeaderPayloadResult</span><span class=p>(</span>
</span><span id=__span-7-107><a id=__codelineno-7-107 name=__codelineno-7-107 href=#__codelineno-7-107></a>            <span class=n>continue_processing</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
</span><span id=__span-7-108><a id=__codelineno-7-108 name=__codelineno-7-108 href=#__codelineno-7-108></a>            <span class=n>modified_payload</span><span class=o>=</span><span class=n>HttpHeaderPayload</span><span class=p>(</span><span class=n>modified_headers</span><span class=p>),</span>
</span><span id=__span-7-109><a id=__codelineno-7-109 name=__codelineno-7-109 href=#__codelineno-7-109></a>            <span class=n>metadata</span><span class=o>=</span><span class=p>{</span>
</span><span id=__span-7-110><a id=__codelineno-7-110 name=__codelineno-7-110 href=#__codelineno-7-110></a>                <span class=s2>"plugin"</span><span class=p>:</span> <span class=s2>"security_header"</span><span class=p>,</span>
</span><span id=__span-7-111><a id=__codelineno-7-111 name=__codelineno-7-111 href=#__codelineno-7-111></a>                <span class=s2>"action"</span><span class=p>:</span> <span class=s2>"compliance_validated"</span><span class=p>,</span>
</span><span id=__span-7-112><a id=__codelineno-7-112 name=__codelineno-7-112 href=#__codelineno-7-112></a>                <span class=s2>"audit_trail_added"</span><span class=p>:</span> <span class=kc>True</span><span class=p>,</span>
</span><span id=__span-7-113><a id=__codelineno-7-113 name=__codelineno-7-113 href=#__codelineno-7-113></a>                <span class=s2>"response_time"</span><span class=p>:</span> <span class=n>response_time</span>
</span><span id=__span-7-114><a id=__codelineno-7-114 name=__codelineno-7-114 href=#__codelineno-7-114></a>            <span class=p>}</span>
</span><span id=__span-7-115><a id=__codelineno-7-115 name=__codelineno-7-115 href=#__codelineno-7-115></a>        <span class=p>)</span>
</span><span id=__span-7-116><a id=__codelineno-7-116 name=__codelineno-7-116 href=#__codelineno-7-116></a>
</span><span id=__span-7-117><a id=__codelineno-7-117 name=__codelineno-7-117 href=#__codelineno-7-117></a>    <span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>_get_user_token</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-7-118><a id=__codelineno-7-118 name=__codelineno-7-118 href=#__codelineno-7-118></a><span class=w>        </span><span class=sd>"""Retrieve user-specific authentication token."""</span>
</span><span id=__span-7-119><a id=__codelineno-7-119 name=__codelineno-7-119 href=#__codelineno-7-119></a>        <span class=c1># Implementation would connect to token service</span>
</span><span id=__span-7-120><a id=__codelineno-7-120 name=__codelineno-7-120 href=#__codelineno-7-120></a>        <span class=k>return</span> <span class=sa>f</span><span class=s2>"token_for_</span><span class=si>{</span><span class=n>user</span><span class=si>}</span><span class=s2>"</span>
</span><span id=__span-7-121><a id=__codelineno-7-121 name=__codelineno-7-121 href=#__codelineno-7-121></a>
</span><span id=__span-7-122><a id=__codelineno-7-122 name=__codelineno-7-122 href=#__codelineno-7-122></a>    <span class=k>def</span><span class=w> </span><span class=nf>_classify_request_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span><span id=__span-7-123><a id=__codelineno-7-123 name=__codelineno-7-123 href=#__codelineno-7-123></a><span class=w>        </span><span class=sd>"""Classify request data for compliance purposes."""</span>
</span><span id=__span-7-124><a id=__codelineno-7-124 name=__codelineno-7-124 href=#__codelineno-7-124></a>        <span class=c1># Basic classification logic - could be more sophisticated</span>
</span><span id=__span-7-125><a id=__codelineno-7-125 name=__codelineno-7-125 href=#__codelineno-7-125></a>        <span class=k>if</span> <span class=n>context</span><span class=o>.</span><span class=n>tenant_id</span> <span class=ow>and</span> <span class=s2>"enterprise"</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>tenant_id</span><span class=p>:</span>
</span><span id=__span-7-126><a id=__codelineno-7-126 name=__codelineno-7-126 href=#__codelineno-7-126></a>            <span class=k>return</span> <span class=s2>"confidential"</span>
</span><span id=__span-7-127><a id=__codelineno-7-127 name=__codelineno-7-127 href=#__codelineno-7-127></a>        <span class=k>elif</span> <span class=n>context</span><span class=o>.</span><span class=n>user</span> <span class=ow>and</span> <span class=s2>"@internal.com"</span> <span class=ow>in</span> <span class=n>context</span><span class=o>.</span><span class=n>user</span><span class=p>:</span>
</span><span id=__span-7-128><a id=__codelineno-7-128 name=__codelineno-7-128 href=#__codelineno-7-128></a>            <span class=k>return</span> <span class=s2>"internal"</span>
</span><span id=__span-7-129><a id=__codelineno-7-129 name=__codelineno-7-129 href=#__codelineno-7-129></a>        <span class=k>return</span> <span class=s2>"public"</span>
</span><span id=__span-7-130><a id=__codelineno-7-130 name=__codelineno-7-130 href=#__codelineno-7-130></a>
</span><span id=__span-7-131><a id=__codelineno-7-131 name=__codelineno-7-131 href=#__codelineno-7-131></a><span class=c1># Plugin configuration</span>
</span><span id=__span-7-132><a id=__codelineno-7-132 name=__codelineno-7-132 href=#__codelineno-7-132></a><span class=n>config</span> <span class=o>=</span> <span class=n>PluginConfig</span><span class=p>(</span>
</span><span id=__span-7-133><a id=__codelineno-7-133 name=__codelineno-7-133 href=#__codelineno-7-133></a>    <span class=n>name</span><span class=o>=</span><span class=s2>"security_header_plugin"</span><span class=p>,</span>
</span><span id=__span-7-134><a id=__codelineno-7-134 name=__codelineno-7-134 href=#__codelineno-7-134></a>    <span class=n>description</span><span class=o>=</span><span class=s2>"Enterprise security and compliance header management"</span><span class=p>,</span>
</span><span id=__span-7-135><a id=__codelineno-7-135 name=__codelineno-7-135 href=#__codelineno-7-135></a>    <span class=n>author</span><span class=o>=</span><span class=s2>"Security Team"</span><span class=p>,</span>
</span><span id=__span-7-136><a id=__codelineno-7-136 name=__codelineno-7-136 href=#__codelineno-7-136></a>    <span class=n>version</span><span class=o>=</span><span class=s2>"2.1.0"</span><span class=p>,</span>
</span><span id=__span-7-137><a id=__codelineno-7-137 name=__codelineno-7-137 href=#__codelineno-7-137></a>    <span class=n>kind</span><span class=o>=</span><span class=s2>"plugins.security.SecurityHeaderPlugin"</span><span class=p>,</span>
</span><span id=__span-7-138><a id=__codelineno-7-138 name=__codelineno-7-138 href=#__codelineno-7-138></a>    <span class=n>hooks</span><span class=o>=</span><span class=p>[</span><span class=n>HookType</span><span class=o>.</span><span class=n>HTTP_PRE_FORWARDING_CALL</span><span class=p>,</span> <span class=n>HookType</span><span class=o>.</span><span class=n>HTTP_POST_FORWARDING_CALL</span><span class=p>],</span>
</span><span id=__span-7-139><a id=__codelineno-7-139 name=__codelineno-7-139 href=#__codelineno-7-139></a>    <span class=n>mode</span><span class=o>=</span><span class=n>PluginMode</span><span class=o>.</span><span class=n>ENFORCE</span><span class=p>,</span>  <span class=c1># Critical security - block on violations</span>
</span><span id=__span-7-140><a id=__codelineno-7-140 name=__codelineno-7-140 href=#__codelineno-7-140></a>    <span class=n>priority</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span>  <span class=c1># High priority for security</span>
</span><span id=__span-7-141><a id=__codelineno-7-141 name=__codelineno-7-141 href=#__codelineno-7-141></a>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>"security"</span><span class=p>,</span> <span class=s2>"compliance"</span><span class=p>,</span> <span class=s2>"authentication"</span><span class=p>,</span> <span class=s2>"headers"</span><span class=p>]</span>
</span><span id=__span-7-142><a id=__codelineno-7-142 name=__codelineno-7-142 href=#__codelineno-7-142></a><span class=p>)</span>
</span><span id=__span-7-143><a id=__codelineno-7-143 name=__codelineno-7-143 href=#__codelineno-7-143></a>
</span><span id=__span-7-144><a id=__codelineno-7-144 name=__codelineno-7-144 href=#__codelineno-7-144></a><span class=n>plugin</span> <span class=o>=</span> <span class=n>SecurityHeaderPlugin</span><span class=p>(</span><span class=n>config</span><span class=p>)</span>
</span></code></pre></div> <p><strong>Key Benefits of This Implementation:</strong></p> <table> <thead> <tr> <th>Feature</th> <th>Business Value</th> <th>Security Impact</th> </tr> </thead> <tbody> <tr> <td><strong>Token Injection</strong></td> <td>Seamless user authentication across services</td> <td>Prevents unauthorized API access</td> </tr> <tr> <td><strong>Data Classification</strong></td> <td>Automated compliance labeling</td> <td>Enables data governance tracking</td> </tr> <tr> <td><strong>Security Header Validation</strong></td> <td>OWASP compliance enforcement</td> <td>Prevents XSS, clickjacking attacks</td> </tr> <tr> <td><strong>Audit Trail Creation</strong></td> <td>Complete request/response logging</td> <td>Regulatory compliance, forensics</td> </tr> <tr> <td><strong>Performance Monitoring</strong></td> <td>Response time tracking</td> <td>Operational visibility</td> </tr> </tbody> </table> <p>This example demonstrates how HTTP header hooks enable <strong>defense-in-depth</strong> security strategies while maintaining <strong>operational transparency</strong> and <strong>regulatory compliance</strong>.</p> <h3 id=53-client-elicitation-support>5.3 Client Elicitation Support<a class=headerlink href=#53-client-elicitation-support title="Permanent link">Â¶</a></h3> <p>The plugin framework supports <strong>MCP Client Elicitation</strong>, enabling plugins to dynamically request structured user input during hook execution. This capability follows the MCP specification for bidirectional communication between servers and clients.</p> <h4 id=531-elicitation-flow-architecture>5.3.1 Elicitation Flow Architecture<a class=headerlink href=#531-elicitation-flow-architecture title="Permanent link">Â¶</a></h4> <pre class=mermaid><code>sequenceDiagram
    participant Client as MCP Client
    participant Gateway as MCP Gateway
    participant Plugin as Plugin Hook
    participant Manager as Plugin Manager

    Client-&gt;&gt;Gateway: MCP Request (tool/prompt/resource)
    Gateway-&gt;&gt;Manager: Execute plugin hooks
    Manager-&gt;&gt;Plugin: hook_function(payload, context)
    Plugin-&gt;&gt;Plugin: Needs user input
    Plugin-&gt;&gt;Manager: Return PluginResult(continue_processing=False, elicitation_request=...)
    Manager-&gt;&gt;Gateway: Elicitation required
    Gateway-&gt;&gt;Client: MCP Elicitation Request
    Client-&gt;&gt;Client: User interaction
    Client-&gt;&gt;Gateway: ElicitationResponse (accept/decline/cancel)
    Gateway-&gt;&gt;Manager: Resume plugin execution
    Manager-&gt;&gt;Plugin: hook_function(payload, context + elicitation_responses)
    Plugin-&gt;&gt;Manager: Return PluginResult(continue_processing=True, ...)
    Manager-&gt;&gt;Gateway: Continue processing
    Gateway-&gt;&gt;Client: MCP Response</code></pre> <h4 id=532-plugin-elicitation-pattern>5.3.2 Plugin Elicitation Pattern<a class=headerlink href=#532-plugin-elicitation-pattern title="Permanent link">Â¶</a></h4> <p>Plugins request user elicitation by returning <code>continue_processing=False</code> with an <code>ElicitationRequest</code>:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>tool_pre_invoke</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>payload</span><span class=p>:</span> <span class=n>ToolPreInvokePayload</span><span class=p>,</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>                         <span class=n>context</span><span class=p>:</span> <span class=n>PluginContext</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>ToolPreInvokeResult</span><span class=p>:</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>    <span class=c1># Check if sensitive operation requires user confirmation</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a>    <span class=k>if</span> <span class=n>payload</span><span class=o>.</span><span class=n>name</span> <span class=o>==</span> <span class=s2>"delete_file"</span> <span class=ow>and</span> <span class=ow>not</span> <span class=n>context</span><span class=o>.</span><span class=n>elicitation_responses</span><span class=p>:</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>        <span class=c1># Request user confirmation with structured schema</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>        <span class=n>confirmation_schema</span> <span class=o>=</span> <span class=p>{</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a>            <span class=s2>"type"</span><span class=p>:</span> <span class=s2>"object"</span><span class=p>,</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a>            <span class=s2>"properties"</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>                <span class=s2>"confirm_deletion"</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a>                    <span class=s2>"type"</span><span class=p>:</span> <span class=s2>"boolean"</span><span class=p>,</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a>                    <span class=s2>"description"</span><span class=p>:</span> <span class=s2>"Confirm file deletion"</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a>                <span class=p>},</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a>                <span class=s2>"backup_first"</span><span class=p>:</span> <span class=p>{</span>
</span><span id=__span-8-14><a id=__codelineno-8-14 name=__codelineno-8-14 href=#__codelineno-8-14></a>                    <span class=s2>"type"</span><span class=p>:</span> <span class=s2>"boolean"</span><span class=p>,</span>
</span><span id=__span-8-15><a id=__codelineno-8-15 name=__codelineno-8-15 href=#__codelineno-8-15></a>                    <span class=s2>"description"</span><span class=p>:</span> <span class=s2>"Create backup before deletion"</span><span class=p>,</span>
</span><span id=__span-8-16><a id=__codelineno-8-16 name=__codelineno-8-16 href=#__codelineno-8-16></a>                    <span class=s2>"default"</span><span class=p>:</span> <span class=kc>True</span>
</span><span id=__span-8-17><a id=__codelineno-8-17 name=__codelineno-8-17 href=#__codelineno-8-17></a>                <span class=p>}</span>
</span><span id=__span-8-18><a id=__codelineno-8-18 name=__codelineno-8-18 href=#__codelineno-8-18></a>            <span class=p>},</span>
</span><span id=__span-8-19><a id=__codelineno-8-19 name=__codelineno-8-19 href=#__codelineno-8-19></a>            <span class=s2>"required"</span><span class=p>:</span> <span class=p>[</span><span class=s2>"confirm_deletion"</span><span class=p>]</span>
</span><span id=__span-8-20><a id=__codelineno-8-20 name=__codelineno-8-20 href=#__codelineno-8-20></a>        <span class=p>}</span>
</span><span id=__span-8-21><a id=__codelineno-8-21 name=__codelineno-8-21 href=#__codelineno-8-21></a>
</span><span id=__span-8-22><a id=__codelineno-8-22 name=__codelineno-8-22 href=#__codelineno-8-22></a>        <span class=n>elicitation_request</span> <span class=o>=</span> <span class=n>ElicitationRequest</span><span class=p>(</span>
</span><span id=__span-8-23><a id=__codelineno-8-23 name=__codelineno-8-23 href=#__codelineno-8-23></a>            <span class=n>message</span><span class=o>=</span><span class=sa>f</span><span class=s2>"Confirm deletion of file: </span><span class=si>{</span><span class=n>payload</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>'path'</span><span class=p>)</span><span class=si>}</span><span class=s2>"</span><span class=p>,</span>
</span><span id=__span-8-24><a id=__codelineno-8-24 name=__codelineno-8-24 href=#__codelineno-8-24></a>            <span class=n>schema</span><span class=o>=</span><span class=n>confirmation_schema</span><span class=p>,</span>
</span><span id=__span-8-25><a id=__codelineno-8-25 name=__codelineno-8-25 href=#__codelineno-8-25></a>            <span class=n>timeout_seconds</span><span class=o>=</span><span class=mi>60</span>
</span><span id=__span-8-26><a id=__codelineno-8-26 name=__codelineno-8-26 href=#__codelineno-8-26></a>        <span class=p>)</span>
</span><span id=__span-8-27><a id=__codelineno-8-27 name=__codelineno-8-27 href=#__codelineno-8-27></a>
</span><span id=__span-8-28><a id=__codelineno-8-28 name=__codelineno-8-28 href=#__codelineno-8-28></a>        <span class=k>return</span> <span class=n>ToolPreInvokeResult</span><span class=p>(</span>
</span><span id=__span-8-29><a id=__codelineno-8-29 name=__codelineno-8-29 href=#__codelineno-8-29></a>            <span class=n>continue_processing</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-8-30><a id=__codelineno-8-30 name=__codelineno-8-30 href=#__codelineno-8-30></a>            <span class=n>elicitation_request</span><span class=o>=</span><span class=n>elicitation_request</span>
</span><span id=__span-8-31><a id=__codelineno-8-31 name=__codelineno-8-31 href=#__codelineno-8-31></a>        <span class=p>)</span>
</span><span id=__span-8-32><a id=__codelineno-8-32 name=__codelineno-8-32 href=#__codelineno-8-32></a>
</span><span id=__span-8-33><a id=__codelineno-8-33 name=__codelineno-8-33 href=#__codelineno-8-33></a>    <span class=c1># Process elicitation response</span>
</span><span id=__span-8-34><a id=__codelineno-8-34 name=__codelineno-8-34 href=#__codelineno-8-34></a>    <span class=k>if</span> <span class=n>context</span><span class=o>.</span><span class=n>elicitation_responses</span><span class=p>:</span>
</span><span id=__span-8-35><a id=__codelineno-8-35 name=__codelineno-8-35 href=#__codelineno-8-35></a>        <span class=n>response</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>elicitation_responses</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span><span id=__span-8-36><a id=__codelineno-8-36 name=__codelineno-8-36 href=#__codelineno-8-36></a>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>action</span> <span class=o>==</span> <span class=s2>"decline"</span> <span class=ow>or</span> <span class=n>response</span><span class=o>.</span><span class=n>action</span> <span class=o>==</span> <span class=s2>"cancel"</span><span class=p>:</span>
</span><span id=__span-8-37><a id=__codelineno-8-37 name=__codelineno-8-37 href=#__codelineno-8-37></a>            <span class=k>return</span> <span class=n>ToolPreInvokeResult</span><span class=p>(</span>
</span><span id=__span-8-38><a id=__codelineno-8-38 name=__codelineno-8-38 href=#__codelineno-8-38></a>                <span class=n>continue_processing</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span><span id=__span-8-39><a id=__codelineno-8-39 name=__codelineno-8-39 href=#__codelineno-8-39></a>                <span class=n>violation</span><span class=o>=</span><span class=n>PluginViolation</span><span class=p>(</span>
</span><span id=__span-8-40><a id=__codelineno-8-40 name=__codelineno-8-40 href=#__codelineno-8-40></a>                    <span class=n>reason</span><span class=o>=</span><span class=s2>"User declined operation"</span><span class=p>,</span>
</span><span id=__span-8-41><a id=__codelineno-8-41 name=__codelineno-8-41 href=#__codelineno-8-41></a>                    <span class=n>description</span><span class=o>=</span><span class=s2>"File deletion was cancelled by user"</span><span class=p>,</span>
</span><span id=__span-8-42><a id=__codelineno-8-42 name=__codelineno-8-42 href=#__codelineno-8-42></a>                    <span class=n>code</span><span class=o>=</span><span class=s2>"USER_DECLINED"</span><span class=p>,</span>
</span><span id=__span-8-43><a id=__codelineno-8-43 name=__codelineno-8-43 href=#__codelineno-8-43></a>                    <span class=n>details</span><span class=o>=</span><span class=p>{</span><span class=s2>"action"</span><span class=p>:</span> <span class=n>response</span><span class=o>.</span><span class=n>action</span><span class=p>}</span>
</span><span id=__span-8-44><a id=__codelineno-8-44 name=__codelineno-8-44 href=#__codelineno-8-44></a>                <span class=p>)</span>
</span><span id=__span-8-45><a id=__codelineno-8-45 name=__codelineno-8-45 href=#__codelineno-8-45></a>            <span class=p>)</span>
</span><span id=__span-8-46><a id=__codelineno-8-46 name=__codelineno-8-46 href=#__codelineno-8-46></a>
</span><span id=__span-8-47><a id=__codelineno-8-47 name=__codelineno-8-47 href=#__codelineno-8-47></a>        <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>action</span> <span class=o>==</span> <span class=s2>"accept"</span> <span class=ow>and</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>:</span>
</span><span id=__span-8-48><a id=__codelineno-8-48 name=__codelineno-8-48 href=#__codelineno-8-48></a>            <span class=c1># User confirmed - optionally create backup first</span>
</span><span id=__span-8-49><a id=__codelineno-8-49 name=__codelineno-8-49 href=#__codelineno-8-49></a>            <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>"backup_first"</span><span class=p>,</span> <span class=kc>True</span><span class=p>):</span>
</span><span id=__span-8-50><a id=__codelineno-8-50 name=__codelineno-8-50 href=#__codelineno-8-50></a>                <span class=n>context</span><span class=o>.</span><span class=n>set_state</span><span class=p>(</span><span class=s2>"create_backup"</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span><span id=__span-8-51><a id=__codelineno-8-51 name=__codelineno-8-51 href=#__codelineno-8-51></a>
</span><span id=__span-8-52><a id=__codelineno-8-52 name=__codelineno-8-52 href=#__codelineno-8-52></a>    <span class=k>return</span> <span class=n>ToolPreInvokeResult</span><span class=p>()</span>
</span></code></pre></div> <h4 id=533-common-elicitation-use-cases>5.3.3 Common Elicitation Use Cases<a class=headerlink href=#533-common-elicitation-use-cases title="Permanent link">Â¶</a></h4> <table> <thead> <tr> <th>Use Case</th> <th>Schema Example</th> <th>Security Benefit</th> </tr> </thead> <tbody> <tr> <td><strong>Sensitive Operation Confirmation</strong></td> <td><code>{"confirm": {"type": "boolean"}}</code></td> <td>Prevents accidental destructive actions</td> </tr> <tr> <td><strong>User Preference Collection</strong></td> <td><code>{"format": {"enum": ["json", "xml"]}}</code></td> <td>Personalizes responses dynamically</td> </tr> <tr> <td><strong>Multi-Factor Authentication</strong></td> <td><code>{"otp_code": {"type": "string", "pattern": "^[0-9]{6}$"}}</code></td> <td>Additional security layer</td> </tr> <tr> <td><strong>Data Processing Consent</strong></td> <td><code>{"consent": {"type": "boolean"}, "data_retention_days": {"type": "number"}}</code></td> <td>GDPR compliance</td> </tr> </tbody> </table> <h4 id=534-elicitation-security-guidelines>5.3.4 Elicitation Security Guidelines<a class=headerlink href=#534-elicitation-security-guidelines title="Permanent link">Â¶</a></h4> <ol> <li><strong>No Sensitive Data Requests</strong>: Never request passwords, API keys, or other credentials</li> <li><strong>Clear User Communication</strong>: Provide descriptive messages explaining why input is needed</li> <li><strong>Timeout Management</strong>: Set appropriate timeouts to prevent hanging requests</li> <li><strong>Graceful Degradation</strong>: Handle decline/cancel responses appropriately</li> <li><strong>Schema Validation</strong>: Use strict JSON schemas to validate user input</li> </ol> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># Example: Input validation and sanitization</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=k>async</span> <span class=k>def</span><span class=w> </span><span class=nf>process_elicitation_response</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>:</span> <span class=n>ElicitationResponse</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>bool</span><span class=p>:</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>action</span> <span class=o>!=</span> <span class=s2>"accept"</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>:</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>        <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a>    <span class=c1># Validate against original schema</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a>        <span class=n>jsonschema</span><span class=o>.</span><span class=n>validate</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>elicitation_schema</span><span class=p>)</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a>    <span class=k>except</span> <span class=n>jsonschema</span><span class=o>.</span><span class=n>ValidationError</span><span class=p>:</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a>        <span class=bp>self</span><span class=o>.</span><span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>"Invalid elicitation response format"</span><span class=p>)</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>        <span class=k>return</span> <span class=kc>False</span>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a>    <span class=c1># Additional sanitization</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a>    <span class=k>for</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a>        <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>str</span><span class=p>):</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a>            <span class=c1># Sanitize string inputs</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a>            <span class=n>response</span><span class=o>.</span><span class=n>data</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>=</span> <span class=n>html</span><span class=o>.</span><span class=n>escape</span><span class=p>(</span><span class=n>value</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a>    <span class=k>return</span> <span class=kc>True</span>
</span></code></pre></div> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="September 26, 2025 21:11:28 UTC">September 26, 2025</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Contributors> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 4a4 4 0 0 1 4 4 4 4 0 0 1-4 4 4 4 0 0 1-4-4 4 4 0 0 1 4-4m0 10c4.42 0 8 1.79 8 4v2H4v-2c0-2.21 3.58-4 8-4"></path></svg> </span> <nav> <a href=mailto:30874627+terylt@users.noreply.github.com>terylt</a> </nav> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Apache 2.0 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/IBM/mcp-context-forge target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.feedback", "content.code.annotate", "content.code.copy", "navigation.indexes", "navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.share", "search.suggest", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../assets/javascripts/bundle.92b07e13.min.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>